# 5. 语法分析

### 1. 基本概念

#### 1.1 语法分析的定义

- 语法分析的核心技术是 "文法" 的机内表示问题，将文法变成机器内部的表示形式，继而用这种文法对语法结构进行分析；
- 从形式上说，语法分析是指对给定的符号串(a），判定其是否是某文法G(Z)的句子；
- 即某个文法Z能否通过多步推导或者规约得到a

![语法分析定义](images\语法分析定义.png)



#### 1.2 语法分析的分类

(1) 自顶向下法（推导法)

- 从开始符号出发，采用推导运算，试图自顶向下地构造语法树；
- 习惯上采用“最左推导法”

(2) 自底向上法（归约法)

- 从给定的符号串出发，采用归约运算，试图自底向上地构造语法树
- 习惯上采用“最左归约法”



#### 1.3 算法设计分析

- 自顶向下分析的关键技术是如何确定具有相同左部的产生式的多个候选式；
- 自底向上分析的关键技术是如何确定当前句型的句柄



### 2. 递归子程序法

递归子程序法直接把文法变成程序，递归子程序法属于自顶向下的语法分析方法，故又称为递归下降法；

#### 2.1 设计原理

- 遇终结符,判定是否与当前单词相等，如果相等，则读下一个单词；
- 遇非终结符,调用该非终结符定义的子程序，返回后不读下一单词；
- 遇空串(a)，直接转到出口。



#### 2.2 构造算法

- 示例如下

![递归子程序示例](images\递归子程序示例.png)

#### 2.3 对文法的要求

- 具有相同左部的各产生式，右部的首符号不同；
- 文法不能有左递归。

递归子程序要求文法应是LL(1)文法。



### 3. LL(1)文法

#### 3.1 首符号集合、后继符集合与选择符集合

首符号集合：first(a)是从α能够推导出的所有首符号构成的集合；

后继符集合：即follow(A)是所有句型中紧跟在A之后出现的终结符；

选择符集合：first(a) 或者 first(a) 和 follow(A)的并集。



#### 3.2 定义

- LL(1)文法是指文法中，具有相同左部的各产生式，其 **选择符集合** 不相交；
- 具有左递归的文法一定不是LL(1)文法；





### 4. LL(1)分析法

- LL(1)分析法是指从左到右扫描(第一个L)、最左推导(第二个L)和只查看一个当前符号(括号中的1)；
- LL(1)分析法又称预测分析法，属于确定的自顶向下语法分析方法。



#### 4.1 三个要点

(1) 利用一个分析栈，记录分析过程；

(2) 利用一个分析表，保存如何选择产生式的知识；

(3) 要求文法必须是LL(1)文法。



#### 4.2 LL(1)分析表

LL(1)分析表是存储文法选择集合的知识表，结构设计如下。

![分析表结构设计](images\分析表结构设计.png)





#### 4.3 算法分析实例

![LL(1)算法实例](images\LL(1)算法实例.png)





### 5. LR()分析法

#### 5.1 定义

- LR()分析法是指从左到右扫描(第一个L)、最左归约(最右推导的逆过程)(第二个R)之意；
- 它属于自底向上的语法分析方法；
- 常用的方法有LR(0)和LR(1)，其中括号内的数是指无需查看(或只需查看一个1)当前符号，即可确定归约过程。

**三个要点**

LR()分析法的基本要点有三个

(1)利用一个分析栈，记录分析过程；

(2)当栈顶出现句柄时，将句柄归约，否则移进

(3)采用有限自动机作为句柄识别器。

#### 5.2 分析过程示例

![LR分析过程示例](images\LR分析过程示例.png)



#### 5.3 确认句柄

有限自动机作为句柄识别器

TODO



### 6. LR()分析器设计

LR()分析器 = LR控制器 +  LR() 分析表



#### 6.1 LR()控制器设计

控制器设计如下。

![LR()控制器设计](images\LR()控制器设计.png)



#### 6.2 LR(0)文法及判定

(1) LR(0)文法的条件

- 句柄识别器的每个项目集中，不存在移进项目和归约项目同时并存或多个归约项目同时并存；
- 归约时不必查看当前输入符号。



#### 6.3 LR()分析表

LR()分析表是LR()分析法的知识表，是句柄识别器的—种机内表示形式。

![LR分析表](images\LR分析表.png)
