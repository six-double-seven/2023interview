# 传输层

### 1. TCP - 滑动窗口

>参考链接：
>
>- [计算机网络（6）TCP之滑动窗口](https://blog.csdn.net/qq_41963107/article/details/108439024?spm=1001.2014.3001.5502)
>
>- [TCP协议的滑动窗口具体是怎样控制流量的](https://www.zhihu.com/question/32255109#:~:text=1)
>
>目录：
>
>
>
>

#### 1.1 滑动窗口的实现原理

- TCP通过`滑动窗口`实现流量控制，所谓流量控制是为了控制发送方的发送速率，保证接收方来得及接收；
- TCP是双工的协议，TCP会话的双方都各自维护一个发送窗口和一个接收窗口，TCP连接的每一方都有固定大小的缓冲空间，TCP的接收端只允许发送端发送接收端缓冲区可以容纳的数据，当接收方来不及处理发送方的数据，提示发送方降低速率，防止包丢失；
- 接受方发送的确认报文中的`窗口字段`可以用来控制发送方窗口的大小，从而影响发送速率。窗口字段设置为0，则发送方不能发送数据。

#### 1.2 发送方的滑动窗口分为哪几部分

大致可分为四部分：

(1) #1是 已发送并收到ACK确认 的数据：1~31 字节

(2) #2是 已发送但未收到 ACK确认 的数据：32~45 字节

(3) #3是 未发送但总大小在接收方处理范围内（接收方还有空间）：46~51字节

(4) #4是 未发送但总大小超过接收方处理范围（接收方没有空间）：52字节以后



使用**三个指针**对以上四部分进行划分

(1) SND.UNA：是一个绝对指针，它指向的是已发送但未收到确认的第一个字节的序列号，也就是 #2 的第一个字节；

(2) SND.NXT：也是一个绝对指针，它指向未发送但可发送范围的第一个字节的序列号，也就是 #3 的第一个字节；

(3) 指向 #4 的第一个字节是个相对指针，它需要 SND.UNA 指针加上 SND.WND 大小的偏移量，就可以指向 #4 的第一个字节了；



**可用窗口**大小的计算是：

可用窗口 = SND.WND -（SND.NXT - SND.UNA）



![image-20220908183229414](C:\Users\28897\AppData\Roaming\Typora\typora-user-images\image-20220908183229414.png)



#### 1.3 接收方的滑动窗口

大致可分为三部分：

(1) 已成功接收并确认的数据（等待应用进程读取）；

(2) 未收到数据但可以接收的数据；

(3) 未收到数据并不可以接收的数据；



使用**两个指针**对以上三部分进行划分:

(1) RCV.NXT：是一个指针，它指向期望从发送方发送来的下一个数据字节的序列号，也就是 #3 的第一个字节；

(2) 指向 #4 的第一个字节是个相对指针，它需要 RCV.NXT 指针加上 RCV.WND 大小的偏移量，就可以指向 #4 的第一个字节了。



![image-20220908183852766](C:\Users\28897\AppData\Roaming\Typora\typora-user-images\image-20220908183852766.png)



#### 1.4 发送方和接收方滑动窗口的关系

TCP是双工的协议，会话的双方都可以同时接收、发送数据。TCP会话的双方都各自维护一个“发送窗口”和一个“接收窗口”。其中各自的“接收窗口”大小取决于应用、系统、硬件的限制（TCP传输速率不能大于应用的数据处理速率）。各自的“发送窗口”则要求取决于对端通告的“接收窗口”，要求相同。

![image-20220908185604397](C:\Users\28897\AppData\Roaming\Typora\typora-user-images\image-20220908185604397.png)

















